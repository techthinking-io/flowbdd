<!--
  ~ Flow BDD - The most productive way to test.
  ~ Copyright (C) 2021-2025 James Bayliss.
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlowBDD Server - Reports</title>
  <style>
    body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
    header, footer { background: #333; color: white; padding: 1rem 2rem; }
    header nav a, footer a { color: #eee; margin-right: 1rem; text-decoration: none; }
    header nav a:hover, footer a:hover { text-decoration: underline; }
    main { flex: 1; padding: 2rem; }
    .report-card { background: #f9f9f9; border: 1px solid #ddd; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; }
    .suite-list { list-style: none; padding: 0; }
    .suite-item { padding: 0.5rem 0; border-bottom: 1px solid #eee; }
    .suite-item:last-child { border-bottom: none; }
    .footer-links { margin-top: 0.5rem; }
  </style>
</head>
<body>

<header>
  <nav>
    <a href="/">Home</a>
    <a href="/reports/index.html">Last Report (JSON)</a>
    <a href="/runner/index.html">Test Runner</a>
  </nav>
</header>

<main>
  <h1>Latest Manually run test - Report Summary</h1>
  <div id="reportContainer">
    <p>Loading latest report...</p>
  </div>
</main>

<footer>
  <div>&copy; 2021-2025 James Bayliss. Flow BDD - The most productive way to test.</div>
  <div class="footer-links">
    <a href="https://techthinking.io" target="_blank">techthinking.io</a>
    <a href="https://github.com/tech-thinking-io/flowbdd" target="_blank">GitHub Repo</a>
  </div>
</footer>

<script>
  async function loadReport() {
    const container = document.getElementById('reportContainer');
    try {
      const res = await fetch('/api/report/index');
      if (!res.ok) {
        container.innerHTML = '<p>No report found. Run some tests first!</p>';
        return;
      }
      const index = await res.json();
      
      let suitesHtml = '';
      if (index.links && index.links.testSuites) {
        suitesHtml = `
          <h3>Test Suites:</h3>
          <ul class="suite-list">
            ${index.links.testSuites.map(s => `
              <li class="suite-item">
                <strong>${s.name}</strong> - 
                <a href="/api/report/suite/${s.file}" target="_blank">JSON</a>
              </li>
            `).join('')}
          </ul>
        `;
      }

      container.innerHTML = `
        <div class="report-card">
          <p><strong>Generated At:</strong> ${index.timeStamp}</p>
          <hr/>
          <p><strong>Summary:</strong></p>
          <ul>
            <li>Total Tests: ${index.summary.tests}</li>
            <li>Passed: ${index.summary.passed}</li>
            <li>Failed: ${index.summary.failed}</li>
            <li>Skipped: ${index.summary.skipped}</li>
            <li>Aborted: ${index.summary.aborted}</li>
          </ul>
          ${suitesHtml}
        </div>
      `;
    } catch (err) {
      console.error(err);
      container.innerHTML = '<p>Error loading report.</p>';
    }
  }

  loadReport();
</script>

</body>
</html>
