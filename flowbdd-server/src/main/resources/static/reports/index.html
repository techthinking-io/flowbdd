<!--
  ~ Flow BDD - The most productive way to test.
  ~ Copyright (C) 2021-2025 James Bayliss.
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlowBDD Server - Reports</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  <style>
    body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
    main { flex: 1; padding: 2rem; }
    .report-card { background: #f9f9f9; border: 1px solid #ddd; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; }
    .suite-list { list-style: none; padding: 0; }
    .suite-item { padding: 0.5rem 0; border-bottom: 1px solid #eee; }
    .suite-item:last-child { border-bottom: none; }
  </style>
</head>
<body>

<section class="section">
  <div class="container">
    <div th:replace="fragments :: header"></div>

    <main>
      <h1 class="title">Latest Manually run test - Report Summary</h1>
      <div id="reportContainer">
        <p>Loading latest report...</p>
      </div>
    </main>
  </div>
</section>

<footer th:replace="fragments :: footer"></footer>

<script>
  async function loadReport() {
    const container = document.getElementById('reportContainer');
    try {
      const res = await fetch('/api/report/index');
      if (!res.ok) {
        container.innerHTML = '<p>No report found. Run some tests first!</p>';
        return;
      }
      const index = await res.json();
      
      let suitesHtml = '';
      if (index.links && index.links.testSuites) {
        suitesHtml = `
          <h3>Test Suites:</h3>
          <ul class="suite-list">
            ${index.links.testSuites.map(s => {
              const classOnly = s.name.split('.').pop();
              return `
                <li class="suite-item">
                  <strong><a href="/TEST-${s.name}">${classOnly}</a></strong> 
                  <span style="font-size: 0.8rem; color: #666;">(${s.name})</span> - 
                  <a href="/api/report/suite/${s.file}" target="_blank">JSON</a>
                </li>
              `;
            }).join('')}
          </ul>
        `;
      }

      container.innerHTML = `
        <div class="report-card">
          <p><strong>Generated At:</strong> ${index.timeStamp}</p>
          <hr/>
          <p><strong>Summary:</strong></p>
          <ul>
            <li>Total Tests: ${index.summary.tests}</li>
            <li>Passed: ${index.summary.passed}</li>
            <li>Failed: ${index.summary.failed}</li>
            <li>Skipped: ${index.summary.skipped}</li>
            <li>Aborted: ${index.summary.aborted}</li>
          </ul>
          ${suitesHtml}
        </div>
      `;
    } catch (err) {
      console.error(err);
      container.innerHTML = '<p>Error loading report.</p>';
    }
  }

  loadReport();
</script>

</body>
</html>
